---
lab:
    title: 'ラボ 06a: Azure Pipelines を使用した継続的インテグレーションの有効化'
    module: 'モジュール 6: Azure Pipelines を使用した継続的インテグレーションの実装'
---

# ラボ 06a: Azure Pipelines を使用した継続的インテグレーションの有効化
# 受講生用ラボ マニュアル

## ラボの概要

このラボでは、Azure Pipelines でビルドとリリースを使用して、アプリケーションの継続的インテグレーション (CI) と継続的デプロイ (CD) を構成する方法を学習します。このスクリプト可能な CI/CD システムは、Web ベースとクロス プラットフォームの両方であり、高度なワークフローを視覚化するための最新のインターフェイスも提供します。このラボではクロスプラット フォームの可能性のすべてを示すわけではありませんが、iOS、Android、Java (Ant、Maven、または Gradle を使用) および Linux 用にビルドすることもできることを指摘することが重要です。

## 目標

このラボを完了すると、次のことができるようになります。

-   テンプレートから基本的なビルド パイプラインを作成する
-   ビルドを追跡しレビューする
-   継続的インテグレーション ビルドを呼び出す

## ラボの所要時間

-   推定時間: **45 分**

## 手順

### 開始する前に

#### ラボの仮想マシンにログインする

次の認証情報を使用して、Windows 10 仮想マシンにサインインしていることを確認します。
    
-   ユーザー名: **Student**
-   パスワード: **Pa55w.rd**

#### このラボで必要なアプリケーションのレビュー

このラボで使用するアプリケーションを特定:
    
-   Microsoft Edge

#### Azure DevOps 組織を設定します。 

このラボで使用できる Azure DevOps 組織がまだない場合は、[組織またはプロジェクト コレクションの作成](https://docs.microsoft.com/ja-jp/azure/devops/organizations/accounts/create-organization?view=azure-devops)で利用できる手順に従って作成してください。

### 演習 0: ラボの前提条件の構成

この演習では、ラボの前提条件を設定します。Azure DevOps Demo Generator テンプレートに基づいて事前構成された Parts Unlimited チームプロジェクトで構成されます。

#### タスク 1: チーム プロジェクトを構成する

このタスクでは、Azure DevOps Demo Generator を使用し、**Parts Unlimited** テンプレートに基づいて新しいプロジェクトを生成します。

1.  ラボのコンピューターで Web ブラウザーを起動し、[Azure DevOps Demo Generator](https://azuredevopsdemogenerator.azurewebsites.net) に移動します。このユーティリティ サイトは、ラボで必要なコンテンツ (作業項目、リポジトリなど) が事前設定されている新しい Azure DevOps プロジェクトをアカウント内で作成するプロセスを自動化します。 

    > **注**: サイトの詳細については、https://docs.microsoft.com/ja-jp/azure/devops/demo-gen をご覧ください。

1.  「**サインイン**」をクリックし、Azure DevOps サブスクリプションに関連のある Microsoft アカウントを使用してサインインします。
1.  必要な場合は、「**Azure DevOps Demo Generator**」ページで「**承諾する**」をクリックし、Azure DevOps サブスクリプションへのアクセス許可要求を承諾します。
1.  「**新しいプロジェクトの作成**」 ページの 「**新しいプロジェクト名**」 テキストボックスに「**Enabling Continuous Integration with Azure Pipelines**」と入力し、「**組織の選択**」 ドロップダウン リストで、Azure DevOps 組織を選択して、「**テンプレートの選択**」 をクリックします。
1.  テンプレートのリストで、**PartsUnlimited** テンプレートを見つけ、「**テンプレートの選択**」をクリックします。
1.  再び「**新しいプロジェクトの作成**」ページで「**プロジェクトの作成**」をクリックします。

    > **注**: プロセスが完了するまでお待ちください。これにはおよそ 2 分かかる場合があります。プロセスが失敗した場合は、DevOps 組織に移動し、プロジェクトを削除して、再試行してください。

1.  「**新しいプロジェクトの作成**」ページで「**プロジェクトに移動**」をクリックします。

### 演習 1: Azure DevOps ビルドを導入する 

この演習では、テンプレートから基本的なビルド パイプラインを作成し、新しいビルドジョブを追跡および確認して、継続的インテグレーション ビルドをトリガーします。

#### タスク 1: テンプレートから基本的なビルド パイプラインを作成する

このタスクでは、事前定義されたテンプレートを使用してビルド パイプラインを作成および構成します。

1.  前の演習で生成した **Enabling Continuous Integration with Azure Pipelines**プロジェクトで Azure DevOps 組織を表示している Web ブラウザーで、垂直ナビゲーション ペインで、「**パイプライン**」 セクションを選択し、「**パイプライン**」 ビューが表示されていることを確認します。

    > **注**: または、[https://dev.azure.com/`<your-Azure-DevOps-account-name>`/Enabling%20Continuous%20Integration%20with%20Azure%20Pipelines)] URL に移動して、プロジェクト ページに直接アクセスすることもできます。ここで、`<your-Azure-DevOps-account-name>` プレースホルダーは、アカウント名を表します。 

1.  「**パイプライン**」 ペインで、既存の **PartsUnlimitedE2E** パイプラインを表すエントリにマウス ポインターを合わせると、右側に省略記号が表示されます。
1.  省略記号をクリックし、ドロップダウン メニューで 「**Edit**」 をクリックします。

    > **注**: ラボの後半でトリガーされる 2 つのパイプラインを回避するには、テンプレートで作成されたパイプラインの CI トリガーを無効にすることから始めます。

1.  **PartsUnlimitedE2E** ペインの 「**タスク**」 タブで、「**Triggers**」 タブをクリックし、「**Enable continuous integration**」 チェックボックスをオフにして、「**Save & queue**」 をクリックし、「**Save**」 をクリックします。
1.  新しいパイプラインを作成するには、Azure DevOps ポータルの垂直ナビゲーション ペインで 「**パイプライン**」 を選択して、「**パイプライン**」 ビューに戻ります。
1.  「**パイプライン**」 ペインに戻り、「**New pipeline**」 をクリックして、新しいビルド パイプラインを作成します。

    > **注**: ビルド パイプラインのデフォルト オプションには、YAML の使用が含まれます。このラボでは、クラシック エディターを使用します。 

1.  「**Where is your code?**」 ペインで、ページの下部にある 「**Use the classic editor**」 リンクをクリックします。

    > **注**: ソース リポジトリを構成することから始める必要があります。すべての主要なプラットフォームが利用可能ですが、ここで必要なのはデフォルトのオプションだけです。このビルドは、**PartsUnlimited** リポジトリの**Master** ブランチを使用します。 

1.  **PartsUnlimited** リポジトリと**Master** ブランチ エントリを含む **Azure Repos Git** オプションが選択されていることを確認し、「**Continue**」 をクリックします。
1.  「**テンプレートの選択**」 ペインの 「**検索**」 テキスト ボックスに「**ASP.NET**」と入力し、結果のリストで **ASP.NET** テプレートを選択し、「**Apply**」 をクリックしてこのテンプレートをビルド定義に適用します。 

    > **注**: 主流のシナリオすべてをカバーする必要がある多くのオプションがあることに注意してください。ここでは、ベースライン ASP.NET テンプレートを使用してプロジェクトをビルドするだけです。このビルド パイプラインのプロセスは簡単に実行できます。ソースを取得した後、Azure DevOps は NuGet を使用して依存パッケージを復元します。次に、プロジェクトがビルドされ、テストされます。結果は、構成されたターゲットに公開されます。

1.  「**タスク**」 タブを選択し、ドロップ ダウンで選択して、「**エージェントの仕様**」 を window-2019 から vs2017-win2016 に変更します。

1.  「**Valiables**」 タブを選択し、その内容を確認します。

    > **注**: ここでは、構成やプラットフォームなど、ビルド中に使用される特別なパラメーターを構成できます。

1.  「**Triggers**」 タブを選択し、「**継続的インテグレーションの有効化**」 チェックボックスをオンにします。 

    > **注**: これにより、ソースの変更がコミットされるたびにビルドが自動的に呼び出されます。トリガーを使用すると、スケジュールに従って、別のビルドが完了したとき、またはソースに変更が加えられたときに、ビルドを自動的に呼び出すことができます。

1.  「**Options**」 タブを選択し、その内容を確認します。

    > **注**: このセクションには、ビルド ワークフローに関連するさまざまなオプションが含まれています。通常、タスク自体の構成ビューで特定のビルド タスクのオプションを構成することに注意してください。

1.  「**Histry**」 タブを選択します。 

    > **注**: この時点では、タブにはエントリは含まれていませんが、ビルド定義に加えた変更の履歴が表示されます。

1.  「**Save & Queue**」 タブ を選択し、ドロップダウン メニューで 「**Save & queue**」 エントリを選択して、新しいビルドを保存してキューに入れます。

    > **注**: 「**プロジェクト設定**」  >  「**設定**」  >  「**保持ポリシー**」 からパイプライン アーティファクトの保持時間を定義できます。これらの設定を使用すると、保持するパイプラインの実行とその期間を構成できます。 

1.  「**パイプラインの実行**」 ペインで、デフォルト オプションを受け入れ、「**Save and run**」 をクリックします。これにより、パイプライン実行ジョブの 「**概要**」 タブが 「**キュー**」 ステータスで自動的に表示されます。

#### タスク 2: ビルドを追跡しレビューする

このタスクでは、新しいビルド ジョブを追跡して確認します。

> **注**: ビルドが開始されると、タスクごとにコンソール出力を追跡できるようになります。 

1.  パイプライン実行ジョブの 「**概要**」 タブの 「**ジョブ**」 セクションで、 「**Agent job 1**」 をクリックします。これにより、ジョブの詳細ペインが表示されます。

    > **注**: 以前のタスクを確認する場合は、右ペインをスクロールしてログを確認できます。

2.  ビルドが正常に完了したら、ジョブの詳細ペインで、左向きの矢印をクリックして概要ビューに戻ります。 

    > **注**: 概要ビューには、コミット、テスト、アーティファクトに関する詳細など、ビルドに関する概要の詳細が表示されます。

3.  このビルドのテストを確認するには、「**テスト**」 タブを選択します。 

    > **注**: パイプライン エディターに簡単にアクセスしたり、新しいビルドをキューに入れたり、このビルドのアーティファクトをダウンロードしたりすることもできます。

#### タスク 3: 継続的インテグレーションのビルドを呼び出す

このタスクでは、継続的インテグレーション ビルドをトリガーします。

   > **注**: この演習の最初のタスクでは、継続的インテグレーションをサポートするようにビルドを構成しました。このタスクでは、その機能をテストします。

1.  Azure DevOps ポータルでプロジェクト設定を表示している Web ブラウザー ウィンドウの垂直ナビゲーション ペインで、「**リポジトリ**」 セクションを選択し、「**ファイル**」 ビューが表示されていることを確認します。
1.  中央のペインで、ファイル **PartsUnlimited-aspnet45/src/PartsUnlimitedWebsite/Views/Home/Index.cshtml** に移動して選択します。 
1.  **Index.cshtml** ペインで、「**Edit**」 をクリックします。
1.  **Index.cshtml** ペインで、行 `ViewBag.Title = "Home Page";` を `ViewBag.Title = "Lab Project Home Page";` に変更して、「**Commit**」 をクリックします。
1.  「**Commit**」 ペインで、デフォルトのコミットの詳細を受け入れ、「**Commit**」 をクリックします。

    > **注**: これにより、ビルドが自動的にトリガーされます。 

1.  垂直ナビゲーション ペインで、「**パイプライン**」 セクションを選択し、「**パイプライン**」 ビューが表示されていることを確認します。
1.  「**パイプライン**」 ペインで、変更によってトリガーされた新しいビルドを表すエントリが含まれていることを確認します (その番号には末尾の **.2** が含まれていることに注意してください)。 
1.  ビルド エントリをクリックして詳細を表示し、正常に完了したことを確認します。 

#### レビュー

このラボでは、Azure DevOps ポータルを使用して、テンプレートから基本的なビルド パイプラインを作成し、ビルドを追跡およびレビューし、継続的インテグレーションビルドを呼び出しました。
