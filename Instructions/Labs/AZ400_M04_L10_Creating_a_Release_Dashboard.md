---
lab:
  title: リリース ダッシュボードの作成
  module: 'Module 04: Design and implement a release strategy'
---

# リリース ダッシュボードの作成

# 受講生用ラボ マニュアル

## ラボの要件

- このラボには、**Microsoft Edge** または [Azure DevOps 対応ブラウザー](https://docs.microsoft.com/en-us/azure/devops/server/compatibility?view=azure-devops#web-portal-supported-browsers)が必要です。

- **Azure DevOps 組織を設定する:** このラボで使用できる Azure DevOps 組織がまだない場合は、[組織またはプロジェクト コレクションの作成](https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/create-organization?view=azure-devops)に関するページの手順に従って作成してください。

- 既存の Azure サブスクリプションを識別するか、新しいものを作成します。

- Azure サブスクリプションで所有者ロールを持つ Microsoft アカウントまたは Azure AD アカウントを持っていることを確認します。 詳細については、「[Azure ポータルを使用した Azure のロールの割り当ての一覧表示](https://docs.microsoft.com/en-us/azure/role-based-access-control/role-assignments-list-portal)」を参照してください。

## ラボの概要

このラボでは、リリース ダッシュボードの作成と、REST API を使用した、カスタム アプリケーションまたはダッシュボードで利用可能にできる Azure DevOps リリース データの取得の手順を説明します。

ラボでは、Azure DevOps Starter リソースを使用します。これは、アプリケーションをビルドして Azure にデプロイする Azure DevOps プロジェクトを自動的に作成します。

## 目標

このラボを完了すると、次のことができるようになります。

- リリース ダッシュボードを作成します。
- REST API を使用してリリース情報を照会します。

## 推定時間:45 分

## 手順

### 演習 1: リリース ダッシュボードを作成する

この演習では、Azure DevOps 組織にリリース ダッシュボードを作成します。

#### タスク 1: Azure DevOps Starter リソースを作成する

このタスクでは、Azure DevOps Starter リソースを Azure サブスクリプションに作成します。 これにより、Azure DevOps 組織に対応するプロジェクトが自動的に作成されます。

1. ラボ コンピューターで、Web ブラウザーを起動し、[**Azure Portal**](https://portal.azure.com) に移動して、このラボで使用する Azure サブスクリプションで所有者または共同作成者のロールを持つユーザー アカウントでサインインします。
1. Azure portal で、**[DevOps Starter]** リソースの種類を検索して選択し、**[DevOps Starter]** ブレードで **[作成]** をクリックします。
1. **[DevOps Starter]** ブレードの **[新しいアプリケーションで新たに開始します]** ウィンドウで、**[.NET]** タイルを選択し、上部にある **[GitHub を使用して DevOps Starter を設定する]** の横で設定を変更し、**[ここ]** をクリックして **[Azure DevOps]** > **[完了]** > **[次へ: フレームワーク >]** を選択します。
1. **[DevOps Starter]** ブレードの **[アプリケーション フレームワークの選択]** ウィンドウで、**[ASP<nolink>.NET Core]** タイルを選択し、**[データベースの追加]** スライダーを **[オン]** の位置に移動して、**[次へ: サービス >]** をクリックします。
1. **[DevOps Starter]** ブレードの **[アプリケーションを配置する Azure サービスを選択します]** ウィンドウで、**[Windows Web アプリ]** タイルが選択されていることを確認し、**[次へ: 作成 >]** をクリックします。
1. **[DevOps Starter]** ブレードの、**[もう少しで完了です]** ペイン上で、次の設定を指定します。

    | 設定 | [値] |
    | ------- | ----- |
    | プロジェクト名 | **リリース ダッシュボードの作成** |
    | Azure DevOps 組織 | このラボで使用する Azure DevOps 組織の名前 |
    | サブスクリプション | このラボで使用している Azure サブスクリプションの名前 |
    | Web アプリの名前 | 文字、数字、ハイフンで構成され、文字または数字で開始および終了する 2 から 60 文字のグローバルに一意の文字列 |
    | Location | Azure Web アプリと Azure SQL データベースをデプロイする Azure リージョンの名前 |

1. **[DevOps Starter]** ブレードの **[もう少しで完了です]** ペインで、**[追加の設定]** をクリックします。
1. **[追加設定]** ペインで、次の設定を指定して **[OK]** をクリックします。

    | 設定 | 値 |
    | ------- | ----- |
    | リソース グループ | **az400m10l02-rg** |
    | 価格レベル | **F1 Free** |
    | Application Insights の場所 | Azure Web アプリの場所として選択したものと同じ Azure リージョンの名前 |
    | サーバー名 | 文字、数字、ハイフンで構成され、文字または数字で開始および終了する 3 から 63 文字のグローバルに一意の文字列 |
    | ユーザー名を入力してください | **dbadmin** |
    | Location | Azure Web アプリの場所として選択したものと同じ Azure リージョンの名前 |
    | データベース名 | **az400m10l02-db** |

1. **[DevOps Starter]** ブレードに戻り、**[もう少しで完了です]** ペインで、**[完了]**、**[レビューと作成]** の順にクリックします。

    > **注**: デプロイが完了するまで待ちます。 **DevOps Starter** リソースのプロビジョニングには約 2 分かかります。

1. DevOps Starter リソースがプロビジョニングされたことの確認を受け取ったら、**[リソースに移動]** ボタンをクリックします。 これにより、ブラウザーが [DevOps Starter] ブレードにリダイレクトされます。
1. DevOps Starter ブレードで、正常に完了するまで CI/CD パイプラインの進行状況をトラックします。

    > **注**: 対応する Azure Web アプリと Azure SQL データベースの作成には、約 5 分かかる場合があります。 このプロセスでは、すぐにデプロイできるリポジトリと、ビルド パイプラインやリリース パイプラインを含む Azure DevOps プロジェクトが自動的に作成されます。 Azure リソースは、自動的にトリガーされるデプロイ パイプラインの一部として作成されます。

#### タスク 2: Azure DevOps リリースを作成する

このタスクでは、デプロイに失敗するリリースを含め、いくつかの Azure DevOps リリースを作成します。

1. Azure portal を表示している Web ブラウザーの DevOps Starter ページのツールバーで、**[プロジェクトのホームページ]** をクリックします。 これにより、別のブラウザー タブが自動的に開き、Azure Devops ポータルに**リリース ダッシュボードの作成**プロジェクトが表示されます。 サインインを求められたら、Azure DevOps 組織の資格情報で認証します。

    > **注**: 最初に、正常にデプロイされる新しいリリースを作成します。

1. Azure DevOps ポータルの左側の垂直メニューで **[リポジトリ]** をクリックし、リポジトリ内のフォルダーのリストで、**Application\\aspnet-core-dotnet-core\\Pages** フォルダーに移動し、**Index.cshtml** エントリをクリックします。
1. **Index.cshtml** ペインで **[編集]** をクリックし、**20** 行目で `<div class="description line-2"> Your ASP.NET Core app is up and running on Azure</div>` を `<div class="description line-2"> Your ASP.NET Core app v1.1 is up and running on Azure</div>` に置き換え、**[コミット]** をクリックし、**[コミット]** ペインでもう一度 **[コミット]** をクリックします。 これにより、ビルド パイプラインが自動的にトリガーされます。
1. Azure DevOps ポータルの左側の垂直ナビゲーション ペインで、**[Pipelines]** をクリックします。
1. **[Pipelines]** ペインの **[最近]** タブで、**az400m10l02-CI** エントリをクリックし、**[az400m10l02-CI]** ペインの **[実行]** タブで、最新の実行を選択します。実行の **[概要]** タブで、**[ジョブ]** セクションの **[ビルド]** をクリックし、正常に完了するまでジョブを監視します。
1. ジョブが完了したら、Azure DevOps ポータルの左側の垂直ナビゲーションペインの **[パイプライン]** セクションで、**[リリース]** をクリックします。
1. **az400m10l02-CD** ペインの **[リリース]** タブで **[リリース-2]** エントリをクリックし、**[リリース-2]** ペインの **[パイプライン]** タブで **[開発]** ステージをクリックし、**[開発]** ペインで **[ログの表示]** をクリックして、正常に完了するまで、デプロイの進行状況を監視します。

    > **注**: ここで、デプロイが失敗する新しいリリースを作成します。 このエラーは、組み込みのアセンブリ テストによって発生します。このテストでは、新しいリリースに関連付けられている変更が無効であると見なされます。

1. Azure DevOps ポータルの左側の垂直メニューで **[リポジトリ]** をクリックし、リポジトリ内のフォルダーのリストで、**Application\\aspnet-core-dotnet-core\\Pages** フォルダーに移動し、**Index.cshtml** エントリをクリックします。
1. **Index.cshtml** ウィンドウで、**[編集]**] をクリックします。 **4** の行で、`ViewData["Title"] = "Home Page - ASP.NET Core";` を `ViewData["Title"] = "Home Page v1.2 - ASP.NET Core";` に置き換えます。 **[コミット]** をクリックします。 **[コミット]** ペインで、**[コミット]** を再度クリックします。 これにより、ビルド パイプラインが自動的にトリガーされます。
1. Azure DevOps ポータルの左側の垂直ナビゲーション ペインで、**[Pipelines]** をクリックします。
1. **[Pipelines]** ペインの **[最近]** タブで、**az400m10l02-CI** エントリをクリックし、**[az400m10l02-CI]** ペインの **[実行]** タブで、最新の実行を選択します。実行の **[概要]** タブで、**[ジョブ]** セクションの **[ビルド]** をクリックし、正常に完了するまでジョブを監視します。
1. ジョブが完了したら、Azure DevOps ポータルの左側の垂直ナビゲーションペインの **[パイプライン]** セクションで、**[リリース]** をクリックします。
1. **az400m10l02-CD** ペインの **[リリース]** タブで **[リリース-3]** エントリをクリックし、**[リリース-3]** ペインの **[パイプライン]** タブで**開発**ステージをクリックし、**[開発]** ペインで **[ログの表示]** をクリックして、**テスト アセンブリ**段階で失敗するまで、デプロイの進行状況を監視します。

#### タスク 3: Azure DevOps リリース ダッシュボードを作成する

このタスクでは、ダッシュボードを作成し、そこにリリース関連のウィジェットを追加します。

1. Azure DevOps ポータルの左側の垂直メニューで **[概要]** をクリックし、**[概要]** セクションで **[ダッシュボード]** をクリックして、**[ウィジェットの追加]** をクリックします。
1. **[ウィジェットの追加]** ペインで、ウィジェットのリストを下にスクロールし、**[デプロイの状態]** エントリを選択して、**[追加]** をクリックします。
1. 前のステップで説明した手順を使用して、**リリース正常性の詳細**、**リリース正常性の概要**、**リリース パイプラインの概要**ウィジェットを追加します。
    > **注**: マーケットプレースの [[チーム プロジェクトの正常性]](https://marketplace.visualstudio.com/items?itemName=ms-devlabs.TeamProjectHealth) から **[リリース正常性の詳細]** と **[リリース正常性の概要]** をインストールします
1. マウスを使用して **[リリース パイプラインの概要]** を**デプロイの状態** ウィジェットの右側にドラッグし、ダッシュボードを垂直方向にスクロールして **[編集を完了]** をクリックする必要がなくなるようにします。
1. ダッシュボード ペインに戻り、**デプロイの状態** ウィジェットを表す長方形で、**[ウィジェットの構成]** をクリックします。
1. **[構成]** ペインで、次の設定を指定し (他のすべての設定は既定値のままにします)、**[保存]** をクリックします。

    | 設定 | 値 |
    | ------- | ----- |
    | ビルド パイプライン | **az400m10l02 - CI** |
    | リンクされたリリース パイプライン | **az400m10l02 - CD; az400m10l02 - CD\dev** |

1. ダッシュボードペインに戻り、**[リリース ヘルスの概要]** ウィジェットを表す長方形の右上隅に、**[その他のアクション]** メニューを表す省略記号を表示し、それをクリックして、ドロップダウンメニューで **[構成]** をクリックします。  
1. **[構成]** ペインで、次の設定を指定し (他のすべての設定は既定値のままにします)、**[保存]** をクリックします。

    | 設定 | 値 |
    | ------- | ----- |
    | リリース定義を選択する | **az400m10l02 - CD** |

1. ダッシュボードペインに戻り、**[リリース ヘルスの詳細]** ウィジェットを表す長方形の右上隅に、**[その他のアクション]** メニューを表す省略記号を表示し、それをクリックして、ドロップダウンメニューで **[構成]** をクリックします。  
1. **[構成]** ペインで、次の設定を指定し (他のすべての設定は既定値のままにします)、**[保存]** をクリックします。

    | 設定 | 値 |
    | ------- | ----- |
    | 定義 | **az400m10l02 - CD** |

1. ダッシュボードペインに戻り、**[ヘルス パイプラインの概要]** ウィジェットを表す長方形の右上隅に、**[その他のアクション]** メニューを表す省略記号を表示し、それをクリックして、ドロップダウンメニューで **[構成]** をクリックします。  
1. **[構成]** ペインで、次の設定を指定し (他のすべての設定は既定値のままにします)、**[保存]** をクリックします。

    | 設定 | 値 |
    | ------- | ----- |
    | リリース パイプライン | **az400m10l02 - CD** |

1. ダッシュボード ペインに戻り、**[更新]** クリックしてウィジェットで表示されるコンテンツを更新します。

    > **注**: ウィジェットのリンクを使用すると、Azure DevOps ポータルで対応するペインに直接移動できます。

### 演習 2: REST API を介してリリース情報をクエリする

この演習では、Postman を使用して REST API を介してリリース情報をクエリします。

#### タスク 1: Azure DevOps 個人用アクセス トークンを生成する

このタスクでは、Azure DevOps 個人用アクセス トークンを生成します。これは、この演習の次のタスクでインストールする Postman アプリからの認証に使用されます。

1. ラボのコンピューターを使い、Azure DevOps ポータルが表示されている Web ブラウザー ウィンドウで Azure DevOps ページの右上コーナーにある **[ユーザー設定]** アイコンをクリックします。ドロップダウン メニューで **[個人用アクセス トークン]** をクリックし、**[個人用アクセス トークン]** ペインで **[+ 新しいトークン]** をクリックします。
1. **[新しい個人用アクセス トークンの作成]** ペインで **[すべてのスコープを表示]** リンクをクリックし、以下の設定を指定し、**[作成]** をクリックします (他はすべて、既定値のままにします):

    | 設定 | 値 |
    | --- | --- |
    | 名前 | **リリース ダッシュボード ラボの作成** |
    | 範囲 | **リリース** |
    | アクセス許可 | **読み取り** |
    | 範囲 | **ビルド** |
    | アクセス許可 | **読み取り** |

1. **[成功]** ペインで個人用アクセス トークンの値をクリップボードにコピーします。

    > **注**:必ずトークンの値を記録してください。 このペインを閉じると、取得できなくなります。

1. **[成功]** ペインで **[閉じる]** をクリックします。

#### タスク 2: Postman を使用して REST API を介してリリース情報をクエリする

このタスクでは、Postman を使用して REST API を介してリリース情報をクエリします。

1. ラボ コンピューターで、Web ブラウザーを起動し、[Postman ダウンロードページ](https://www.postman.com/downloads/)に移動し、**[アプリのダウンロード]** ボタンをクリックし、ドロップダウン メニューで、**[Windows 64 ビット]** をクリックし、ダウンロードしたファイルをクリックして、インストールします。 インストールが完了すると、Postman デスクトップ アプリが自動的に起動します。
1. **[Postman アカウントの作成]** ペインで、メール アドレス、ユーザー名、パスワードを入力し、**[無料アカウントの作成]** をクリックします。

    > **注**: Postman から、アカウント プロビジョニングのプロセスを完了するために Postman アカウントをアクティブ化するためのメールが届きます。

1. サインインしたら、Postman デスクトップ アプリ ウィンドウの左上隅にある **[新規]** をクリックし、**[新規作成]** ペインで **[要求]** をクリックし、**[要求の保存]** ペインの **[要求名]** テキストボックスに「**Get-Releases**」と入力して、**[コレクションの作成]** をクリックします。**[コレクションに名前を付ける]** テキストボックスに「**Azure DevOps az400m10l02 クエリ**」と入力し、右側のチェックマークをクリックしてから、**[Azure DevOps az400m10l02 クエリに保存]** ボタンをクリックします。
1. 別の Web ブラウザー ウィンドウを開き、[**Releases - List** Microsoft Docs ページ](https://docs.microsoft.com/en-us/rest/api/azure/devops/release/releases/list?view=azure-devops-rest-6.0)に移動し、その内容を確認します。
1. Postman デスクトップ アプリに戻り、アプリ ウィンドウの右上セクションにある [Launchpad] ペインで、**[認可]** タブ ヘッダーをクリックし、**[種類]** ドロップダウン リストで **[基本認証]** エントリを選択し、**[パスワード]** テキスト ボックスに前のタスクでコピーしたトークンの値を貼り付けます (**[ユーザー名]** テキスト ボックスの値は設定しないでください)。
1. アプリ ウィンドウの右上のセクションにある [スタート パッド] ペインで、ドロップダウン リストに **GET** が表示されていることを確認し、すべてのリリースを一覧表示するには、**[要求 URL を入力してください]** テキストボックスに次のように入力して、**[送信]** をクリックします (`<organization_name>` の値を Azure DevOps 組織の名前に置き換えます)。

    ```url
    https://vsrm.dev.azure.com/<organization_name>/Creating%20a%20Release%20Dashboard/_apis/release/releases?api-version=6.0
    ```

1. アプリ ウィンドウの右下のセクションにある **[本文]** タブにリストされている出力を確認し、このラボの前の演習で作成したリリースのリストが含まれていることを確認します。
1. Microsoft Docs のコンテンツを表示している Web ブラウザー ウィンドウに切り替え、[**Deployments - List** Microsoft Docs ページ](https://docs.microsoft.com/en-us/rest/api/azure/devops/release/deployments/list?view=azure-devops-rest-6.0)に移動して、そのコンテンツを確認します。
1. アプリ ウィンドウの右上のセクションにある [スタート パッド] ペインで、ドロップダウン リストに **GET** が表示されていることを確認し、すべてのデプロイを一覧表示するには、**[要求 URL を入力してください]** テキストボックスに次のように入力して、**[送信]** をクリックします (`<organization_name>` の値を Azure DevOps 組織の名前に置き換えます)。

    ```url
    https://vsrm.dev.azure.com/<organization_name>/Creating%20a%20Release%20Dashboard/_apis/release/deployments?api-version=6.0
    ```

1. アプリ ウィンドウの右下のセクションにある **[本文]** タブにリストされている出力を確認し、このラボの前の演習で作成したデプロイのリストが含まれていることを確認します。
1. アプリ ウィンドウの右上のセクションにある [スタート パッド] ペインで、ドロップダウン リストに **GET** が表示されていることを確認し、すべてのデプロイを一覧表示するには、**[要求 URL を入力してください]** テキストボックスに次のように入力して、**[送信]** をクリックします (`<organization_name>` の値を Azure DevOps 組織の名前に置き換えます)。

    ```url
    https://vsrm.dev.azure.com/<organization_name>/Creating%20a%20Release%20Dashboard/_apis/release/deployments?DeploymentStatus=failed&api-version=6.0
    ```

1. アプリウィンドウの右下のセクションにある **[本文]** タブにリストされている出力を確認し、このラボの前の演習で開始した失敗したデプロイのみが含まれていることを確認します。

### 演習 3:Azure ラボ リソースを削除する

この演習では、このラボでプロビジョニングした Azure リソースを削除し、予期しない料金を排除します。

>**注**:新規に作成し、使用しなくなったすべての Azure リソースを削除することを忘れないでください。 使用していないリソースを削除することで、予期しない料金が発生しなくなります。

#### タスク 1:Azure ラボ リソースを削除する

このタスクでは、Azure Cloud Shell を使用して、このラボでプロビジョニングされた Azure リソースを削除し、不要な料金を排除します。

1. Azure portal で、**Cloud Shell** ウィンドウ内で **Bash** シェル セッションを開きます。
1. 次のコマンドを実行して、このモジュールのラボ全体で作成したすべてのリソース グループのリストを表示します。

    ```sh
    az group list --query "[?starts_with(name,'az400m10l02-rg')].name" --output tsv
    ```

1. 次のコマンドを実行して、このモジュールのラボ全体を通して作成したすべてのリソース グループを削除します。

    ```sh
    az group list --query "[?starts_with(name,'az400m10l02-rg')].[name]" --output tsv | xargs -L1 bash -c 'az group delete --name $0 --no-wait --yes'
    ```

    >**注**:コマンドは非同期に実行されるので (--nowait パラメーターで決定される)、同じ Bash セッション内ですぐに別の Azure CLI コマンドを実行できますが、リソース グループが実際に削除されるまでに数分かかります。

## 確認

このラボでは、リリース ダッシュボードを作成して構成する方法と、REST API を使用して Azure DevOps リリース データを取得する方法について説明しました。
